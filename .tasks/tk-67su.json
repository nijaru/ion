{
  "project": "tk",
  "ref": "67su",
  "title": "Review and refactor TUI clearing/repaint logic",
  "description": "Review all screen clearing code paths (needs_full_repaint, needs_selector_clear, reset_for_reflow, etc). Consolidate and ensure no unnecessary full-screen clears. Test selector exit, resize, session load.",
  "status": "done",
  "priority": 3,
  "labels": [],
  "assignees": [],
  "parent": null,
  "blocked_by": [],
  "estimate": null,
  "due_date": null,
  "logs": [
    {
      "ts": "2026-02-05T20:23:51.866Z",
      "msg": "Implemented: removed agent 2-space indent, simplified Resize/FocusGained to chat_row=None (preserving last_ui_start), removed handle_resize_reflow, force_full_repaint, needs_full_repaint, clear_scrollback_on_repaint, reset_for_reflow. 323 tests pass, clippy clean."
    },
    {
      "ts": "2026-02-05T23:15:16.025Z",
      "msg": "Replaced Clear with ScrollUp for resize and /clear - preserves terminal scrollback"
    },
    {
      "ts": "2026-02-06T03:54:25.886Z",
      "msg": "Fixed row-tracking clear regression in draw_direct (min(old,new) was wiping chat). Fixed FocusGained resetting chat_row (caused gap on tab switch). Dirty tracking added to skip idle redraws. All TUI rendering paths working: normal chat, resize reflow, tab switch, selector, /clear."
    },
    {
      "ts": "2026-02-06T04:38:37.524Z",
      "msg": "Review complete (3 subagents): No critical issues. Fixed queued msg prefix inconsistency (> â†’ â€º). Two low-priority WARNs: u16 truncation on chat_lines.len() (edge case >65535 lines), unchecked u16 add in render_input_direct on tiny terminals. NIT: duplicated skip-agent logic in 3 places, run.rs growing (528 lines) - both tracked by tk-epd1."
    }
  ],
  "created_at": "2026-02-05T18:42:31.663Z",
  "updated_at": "2026-02-06T04:38:37.524Z",
  "completed_at": "2026-02-05T23:15:16.005Z",
  "external": {}
}