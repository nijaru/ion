{
  "project": "tk",
  "ref": "add8",
  "title": "[ARCH] RNK migration spike for TUI stability",
  "description": "Time-boxed RNK spike on branch codex/rnk-bottom-ui-spike. Scope: bottom UI only (input/progress/status); keep chat history insertion + scrollback behavior on current custom crossterm path. Compare resize/autowrap/scrollback behavior against current baseline and apply kill criteria if RNK regressions match/exceed baseline or require taking over chat semantics.",
  "status": "active",
  "priority": 2,
  "labels": [],
  "assignees": [],
  "parent": null,
  "blocked_by": [],
  "estimate": null,
  "due_date": null,
  "logs": [
    {
      "ts": "2026-02-11T23:33:52.040Z",
      "msg": "Planning context captured in ai/design/runtime-stack-integration-plan-2026-02.md. RNK spike should start with bottom-UI/composer path and keep chat history semantics stable."
    },
    {
      "ts": "2026-02-12T00:24:44.106Z",
      "msg": "2026-02-11 review: rnk (v0.17.3, 158 DL) is immature but architecture aligns perfectly with Ion inline model (println above UI, flexbox bottom layout). Decision: proceed with spike, fork-ready mindset. Scope: bottom UI only (input/progress/status). Kill criteria: if rnk resize bugs match or exceed current bugs. See ai/research/tui-crates-2026-02.md, ai/design/runtime-stack-integration-plan-2026-02.md."
    },
    {
      "ts": "2026-02-12T04:59:35.780Z",
      "msg": "Roadmap alignment 2026-02-12: spike remains approved but gated behind tk-86lk closure; execute on codex/rnk-bottom-ui-spike with explicit keep/kill decision."
    },
    {
      "ts": "2026-02-12T05:06:42.865Z",
      "msg": "Reprioritized 2026-02-12: promoted to current focus (core TUI direction)."
    },
    {
      "ts": "2026-02-12T05:23:24.696Z",
      "msg": "Implemented first RNK spike slice: env-gated bottom-UI renderer (ION_RNK_BOTTOM_UI) using rnk::render_to_string_no_trim for progress/input/status rows while preserving existing chat scrollback path. Wired switch in src/tui/render/direct.rs; default path unchanged. Validation: cargo check -q; cargo test -q tui:: (184 passed)."
    },
    {
      "ts": "2026-02-12T06:42:59.554Z",
      "msg": "RNK spike follow-up: restored colored status mode label ([READ]/[WRITE]) via RNK span styling; added dedicated progress spacer row by increasing progress region in RNK mode and drawing progress on region bottom row."
    },
    {
      "ts": "2026-02-12T06:43:02.426Z",
      "msg": "Validation: cargo check -q, cargo test -q tui::render::, cargo test -q tui:: all pass after RNK status/spacer fixes."
    },
    {
      "ts": "2026-02-12T06:52:42.421Z",
      "msg": "Adjusted RNK spacer behavior: reserve extra progress-gap row only while is_running to avoid extra idle blank lines on startup/restart."
    },
    {
      "ts": "2026-02-12T07:15:10.077Z",
      "msg": "Architectural direction confirmed: chat history should move to soft-wrap append-only model independent of RNK decision. RNK spike remains bottom-UI evaluation slice."
    },
    {
      "ts": "2026-02-12T07:20:47.642Z",
      "msg": "Decision update: proceed RNK-first on spike branch; collapse bottom-UI split path instead of maintaining env-gated dual rendering during spike."
    },
    {
      "ts": "2026-02-12T07:23:49.535Z",
      "msg": "Cleanup for single path: removed unused crossterm bottom-UI modules (input_box/progress/status/widgets) and render mod references."
    },
    {
      "ts": "2026-02-12T07:23:49.608Z",
      "msg": "Validation: cargo check -q, cargo test -q tui::, cargo test -q all pass after RNK-first collapse."
    },
    {
      "ts": "2026-02-12T07:53:23.977Z",
      "msg": "Validation after full UI-surface RNK migration: cargo check -q, cargo test -q tui::, cargo test -q all pass."
    },
    {
      "ts": "2026-02-12T07:54:00.467Z",
      "msg": "Migrated selector renderer, popup/completer rendering, and history-search prompt rendering to RNK primitives; remaining crossterm usage in TUI is terminal control + chat scrollback plumbing."
    },
    {
      "ts": "2026-02-12T08:17:00.398Z",
      "msg": "Refined RNK spike resize behavior: removed resize-triggered full reflow; use viewport overlap scrolling to preserve single-copy native history on terminal resize."
    },
    {
      "ts": "2026-02-12T08:17:31.354Z",
      "msg": "Post-fix validation: cargo test -q (451 pass). Clippy -D warnings still fails due existing repo-wide warnings unrelated to this change."
    },
    {
      "ts": "2026-02-13T00:45:37.985Z",
      "msg": "RNK rendering consolidation: added shared rnk_text helper; removed per-module duplicate RNK line renderers (rnk_spike/popup/selector/history); StyledLine write path now renders through RNK spans/text instead of crossterm StyledContent."
    },
    {
      "ts": "2026-02-13T00:45:38.821Z",
      "msg": "Resize hardening pass: Event::Resize now triggers viewport reflow from canonical chat lines; Reflow pre-op repaints visible chat viewport at new width (clear + write visible tail) to avoid stale soft-wrap row accounting and word-cut overlap."
    }
  ],
  "created_at": "2026-02-11T23:32:50.878Z",
  "updated_at": "2026-02-13T00:45:38.821Z",
  "completed_at": null,
  "external": {}
}